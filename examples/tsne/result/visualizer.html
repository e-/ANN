<!DOCTYPE html>
<body>
  <svg width="400" height="400" id="vis"><g></svg>
  
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-contour.v1.min.js"></script>

  <script>

let iter = 0;

setInterval(() => {
  draw('#vis g', 'result.' + iter + '.txt')
  iter++;
  if(iter > 90) iter = 0;
}, 300);

function translate(x, y) { return 'translate(' + x + ',' + y + ')'; }

function draw(svgId, path) {
  d3.text(path, text => {
    let data = d3.tsvParseRows(text, d => {
      r = d[0].split(' ')

      return [+r[0], +r[1]]
    })

    let width = 380, height = 380;
    let svg = d3.select(svgId).attr('transform', translate(10, 10))

    let x = d3.scaleLinear().domain(d3.extent(data, d => d[0])).range([0, width])
    let y = d3.scaleLinear().domain(d3.extent(data, d => d[1])).range([0, height])

    let color = d3.scaleSequential(d3.interpolateCool).domain([0, 0.2]).clamp(true)

    let path = svg.selectAll('path')
      .data(d3.contourDensity()
        .x(d => x(d[0]))
        .y(d => y(d[1]))
        .size([width, height])
        .bandwidth(8)
        (data)
      )

    let enter = path
        .enter()
          .append('path')

    path.merge(enter)

    path
      .attr('d', d3.geoPath())
      .attr('fill', d => color(d.value))

    path
      .exit().remove()
  })
}

  </script>
</body>
